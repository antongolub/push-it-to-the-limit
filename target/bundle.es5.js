"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _typeof2(a){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof2(a)}(function(a,b){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a["push-it-to-the-limit"]={}))})(void 0,function(a){'use strict';function b(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function c(a){for(var c=1;c<arguments.length;c++){var d=null==arguments[c]?{}:arguments[c],e=Object.keys(d);"function"==typeof Object.getOwnPropertySymbols&&(e=e.concat(Object.getOwnPropertySymbols(d).filter(function(a){return Object.getOwnPropertyDescriptor(d,a).enumerable}))),e.forEach(function(c){b(a,c,d[c])})}return a}function d(a,b,c,d){a(b.call.apply(b,[d].concat(_toConsumableArray(c))))}function e(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"Rejected";a(new Error(b))}function f(a){e(a,"Rejected on cancel")}function g(a){return function(b,d,e){i(b);var f=c({delay:0},e);return"number"==typeof d?f=c({},e,{delay:d}):Array.isArray(d)?f=c({delay:0},e,{limit:d}):"object"===_typeof2(d)&&"number"==typeof d.period&&"number"==typeof d.count?f=c({delay:d},e):"object"===_typeof2(d)&&!Array.isArray(d)&&(f=c({delay:0},e,d)),a(b,f)}}function h(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"Assertion error";if(!a)throw new Error(b)}function i(a){h("function"==typeof a,"Target must be a function")}function j(a){a&&clearTimeout(a)}function k(a){return void 0===a?[]:[].concat(a).map(function(a){return"number"==typeof a?{period:a,count:1}:a})}function l(a,b){for(;0<a.length&&b.isAllowed();)b.decrease(),a.shift().complete()}function m(a,b,c){return setTimeout(function(){return c(a,b)},b.getNextDelay())}function n(a,b,c){return 0<a.length?m(a,b,c):null}function o(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}function p(a,b){return b={exports:{}},a(b,b.exports),b.exports}var q=function(){function a(b){return _classCallCheck(this,a),this.limits=b.map(function(a){return c({},a,{rest:a.count,ttl:0})}),this}return _createClass(a,[{key:"decrease",value:function decrease(){this.limits.forEach(function(a){a.rest+=-1})}},{key:"reset",value:function reset(){this.limits.forEach(this.constructor.refreshLimit)}},{key:"resetTtl",value:function resetTtl(){this.limits.forEach(this.constructor.refreshTtl)}},{key:"isAllowed",value:function isAllowed(){return!this.limits.find(function(a){var b=a.rest;return 1>b})}},{key:"getNextDelay",value:function getNextDelay(){for(var a,b=0,c=this.limits,d=0;d<c.length;d++)a=c[d],1>a.rest&&a.ttl>b&&(b=a.ttl);return b-Date.now()}},{key:"getNextQueueSize",value:function getNextQueueSize(){var a=Math.min;return this.reset(),a.apply(Math,this.limits.map(function(a){var b=a.rest;return b}))}}],[{key:"refreshLimit",value:function refreshLimit(a){return(void 0===a.ttl||a.ttl<Date.now())&&(a.rest=a.count,a.ttl=Date.now()+a.period),a}},{key:"refreshTtl",value:function refreshTtl(a){a.ttl=Date.now()+a.period}}]),a}(),r={leading:!1,trailing:!0},s=g(function(a,b){var e,g,h,i=c({},r,b),l=i.delay,m=i.limit,n=i.context,o=i.rejectOnCancel,p=i.maxWait,s=i.leading,t=i.order,u=new q(k(m||l)),v=[],w=[],x=null,y=function(){null===x&&(x=u.getNextQueueSize());var b=s&&0<x;(0<x||null===h)&&(h=new Promise(function(b,c){v.push({complete:function complete(){return d(b,a,"fifo"===t?w.shift():w.pop(),n)},fail:f.bind(null,c)})}),u.decrease(),x+=-1);for(var c=arguments.length,i=Array(c),k=0;k<c;k++)i[k]=arguments[k];w.push(i),u.resetTtl();var l=u.getNextDelay();if(b){var m=h;return e=setTimeout(y.flush,l),h=null,v.forEach(function(a){return a.complete()}),v.length=0,m}return j(e),e=setTimeout(y.flush,l),p&&!g&&(g=setTimeout(y.flush,p)),h};return y.flush=function(){u.reset(),h=null,x=null,v.forEach(function(a){return a.complete()}),v.length=0,y.cancel()},y.cancel=function(){j(e),j(g),x=null,h=null,e=null,g=null,w.length=0,o&&v.forEach(function(a){return a.fail}),v.length=0},y}),t=g(function(a,b){var d="number"==typeof b.delay?{period:b.delay,count:1/0}:b.delay,e="number"==typeof b.delay?b.delay:void 0;return s(a,c({maxWait:e},b,{delay:d,order:"fifo"}))}),u=g(function(a,b){var d="number"==typeof b.delay?b.delay:void 0;return s(a,c({leading:!0,maxWait:d},b))}),v=g(function(a,b){var c=null,e=b.delay,g=b.limit,h=b.context,i=b.rejectOnCancel,m=k(g||e),o=new q(m),p=[],r=function(a,b){j(c),b.reset(),l(a,b),c=n(a,b,r)},s=function(){for(var b=arguments.length,c=Array(b),e=0;e<b;e++)c[e]=arguments[e];return new Promise(function(b,e){p.push({complete:d.bind(null,b,a,c,h),fail:f.bind(null,e)}),r(p,o)})};return s.flush=function(){p.forEach(function(a){return a.complete()}),s.cancel()},s.cancel=function(){i&&p.forEach(function(a){return a.fail()}),p.length=0,j(c)},s}),w=g(function(a,b){var d="number"==typeof b.delay?b.delay:void 0;return s(a,c({maxWait:d},b))}),x=p(function(a,b){function j(b){return j="function"==typeof Symbol&&"symbol"==_typeof2(Symbol.iterator)?function(b){return _typeof2(b)}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":_typeof2(b)},j(b)}function k(n,o,a,b){if("object"===j(n)){var c=n.target,d=n.delay,e=n.context,f=n.limit;return k(c,d,e,f)}l(n,o);var p=function(){var b=p.timeout,a=p.target,c=p.limit,d=p.context,e=m(c);clearTimeout(b);for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];return(void 0===e||0<e)&&(p.limit=e,p.args=g,p.timeout=setTimeout(p.bind.apply(p,[p].concat(g)),o)),a.call.apply(a,[d].concat(g))};return p.target=n,p.delay=o,p.limit=b,p.context=a,p}function l(c,a){if("function"!=typeof c)throw new Error("repeater: target must be callable");if(!a)throw new Error("repeater: delay must not be empty")}function m(b){return"number"==typeof b?b-1:void 0}Object.defineProperty(b,"__esModule",{value:!0}),b.default=k});o(x);var y=p(function(a,b){var c=function(b){return b&&b.__esModule?b:{default:b}}(x);Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var d=c.default;b.default=d}),z=o(y),A=g(function(a,b){var d=z(c({target:a},b));return d.cancel=function(){j(d.timeout)},d.flush=function(){a.call(d.context,d.args),d.cancel()},d});a.DEFAULT_DELAY=0,a.REJECTED="Rejected",a.REJECTED_ON_CANCEL="Rejected on cancel",a.debounce=s,a.delay=t,a.ratelimit=v,a.repeat=A,a.stabilize=w,a.throttle=u,Object.defineProperty(a,"__esModule",{value:!0})});
